id: rfc5280
rules:
  - id: version-v3
    target: certificate.version
    operator: eq
    operands: [3]
    severity: error

  - id: serial-number-present
    target: certificate.serialNumber
    operator: present
    operands: []
    severity: error

  - id: serial-number-positive
    target: certificate.serialNumber
    operator: positive
    operands: []
    severity: error

  - id: signature-algorithm-secure
    target: certificate.signatureAlgorithm.algorithm
    operator: in
    operands:
      - SHA256-RSA
      - SHA384-RSA
      - SHA512-RSA
      - ECDSA-SHA256
      - ECDSA-SHA384
      - ECDSA-SHA512
      - Ed25519
    severity: error

  - id: signature-algorithm-not-weak
    target: certificate.signatureAlgorithm.algorithm
    operator: notIn
    operands:
      - MD5-RSA
      - SHA1-RSA
      - DSA-SHA1
      - ECDSA-SHA1
    severity: error

  - id: issuer-present
    target: certificate.issuer
    operator: present
    operands: []
    severity: error

  - id: issuer-not-empty
    target: certificate.issuer
    operator: notEmpty
    operands: []
    severity: error

  - id: subject-present
    target: certificate.subject
    operator: present
    operands: []
    severity: warning

  - id: ca-subject-not-empty
    target: certificate.subject
    operator: notEmpty
    operands: []
    severity: error
    appliesTo: [root, intermediate]

  - id: rsa-key-size-minimum
    target: certificate.subjectPublicKeyInfo.publicKey.keySize
    operator: gte
    operands: [2048]
    severity: error

  - id: rsa-exponent-valid
    target: certificate.subjectPublicKeyInfo.publicKey.exponent
    operator: gte
    operands: [65537]
    severity: warning

  - id: authority-key-identifier-present
    target: certificate.authorityKeyIdentifier
    operator: present
    operands: []
    severity: warning
    appliesTo: [leaf, intermediate]

  - id: subject-key-identifier-present
    target: certificate.subjectKeyIdentifier
    operator: present
    operands: []
    severity: warning

  - id: key-usage-present
    target: certificate.keyUsage
    operator: present
    operands: []
    severity: warning

  - id: basic-constraints-present
    target: certificate.basicConstraints
    operator: present
    operands: []
    severity: warning

  - id: not-expired
    target: certificate.validity.notAfter
    operator: after
    operands: []
    severity: error

  - id: not-yet-valid
    target: certificate.validity.notBefore
    operator: before
    operands: []
    severity: error

  - id: ca-key-cert-sign
    target: certificate.keyUsage.keyCertSign
    operator: eq
    operands: [true]
    severity: error
    appliesTo: [root, intermediate]

  - id: ca-basic-constraints
    target: certificate.basicConstraints.cA
    operator: eq
    operands: [true]
    severity: error
    appliesTo: [root, intermediate]

  - id: leaf-not-ca
    target: certificate.basicConstraints.cA
    operator: neq
    operands: [true]
    severity: error
    appliesTo: [leaf]

  - id: signature-valid
    target: certificate
    operator: signedBy
    operands: []
    severity: error

  - id: issuer-matches-subject
    target: certificate
    operator: issuedBy
    operands: []
    severity: error

  - id: aki-matches-ski
    target: certificate
    operator: akiMatchesSki
    operands: []
    severity: warning

  - id: path-len-valid
    target: certificate
    operator: pathLenValid
    operands: []
    severity: error

  - id: san-required-if-empty-subject
    target: certificate
    operator: sanRequiredIfEmptySubject
    operands: []
    severity: error
    appliesTo: [leaf]

  - id: ca-key-usage-valid
    target: certificate
    operator: keyUsageCA
    operands: []
    severity: error
    appliesTo: [root, intermediate]

  - id: leaf-key-usage-valid
    target: certificate
    operator: keyUsageLeaf
    operands: []
    severity: error
    appliesTo: [leaf]

  - id: no-unique-identifiers
    target: certificate
    operator: noUniqueIdentifiers
    operands: []
    severity: error

  - id: serial-number-unique
    target: certificate
    operator: serialNumberUnique
    operands: []
    severity: error
