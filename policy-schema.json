{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/cavoq/pcl/policy-schema.json",
  "$ref": "#/$defs/Policy",
  "$defs": {
    "AuthorityInfoAccessExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical"
        },
        "verifyAccess": {
          "type": "boolean",
          "description": "Verify that URLs are accessible"
        },
        "ocsp": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Expected OCSP responder URLs"
        },
        "caIssuers": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Expected CA issuer certificate URLs"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "AuthorityKeyIDExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical (RFC 5280 recommends non-critical)"
        },
        "required": {
          "type": "boolean",
          "description": "AKI extension must be present (required for all certs except self-signed root CAs)"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "BasicConstraintsExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical (required for CA certificates per RFC 5280)"
        },
        "pathLenConstraint": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum number of subordinate CAs in the chain"
        },
        "isCA": {
          "type": "boolean",
          "description": "Certificate is a Certificate Authority"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "BasicFieldsRule": {
      "properties": {
        "require_v3": {
          "type": "boolean",
          "description": "Require X.509 v3 certificates (RFC 5280 4.1.2.1)"
        },
        "serial_number": {
          "$ref": "#/$defs/SerialNumberRule",
          "description": "Serial number requirements (RFC 5280 4.1.2.2)"
        },
        "signatureAlgorithm": {
          "$ref": "#/$defs/SignatureAlgorithmRule",
          "description": "Signature algorithm constraints (RFC 5280 4.1.2.3)"
        },
        "issuer": {
          "$ref": "#/$defs/NameRule",
          "description": "Issuer name requirements (RFC 5280 4.1.2.4)"
        },
        "validity": {
          "$ref": "#/$defs/ValidityRule",
          "description": "Validity period constraints (RFC 5280 4.1.2.5)"
        },
        "subject": {
          "$ref": "#/$defs/NameRule",
          "description": "Subject name requirements (RFC 5280 4.1.2.6)"
        },
        "subjectPublicKeyInfo": {
          "$ref": "#/$defs/SubjectPublicKeyInfoRule",
          "description": "Public key algorithm constraints (RFC 5280 4.1.2.7)"
        },
        "reject_unique_identifiers": {
          "type": "boolean",
          "description": "Reject deprecated unique identifiers (RFC 5280 4.1.2.8)"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "CRLDistributionPointsExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical"
        },
        "verifyAccess": {
          "type": "boolean",
          "description": "Verify that CRL URLs are accessible"
        },
        "urls": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Expected CRL distribution point URLs"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "CertificatePoliciesExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical"
        },
        "requiredOIDs": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Required policy OIDs (dot notation e.g. 2.16.840.1.101.2.1)"
        },
        "forbiddenOIDs": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Forbidden policy OIDs"
        },
        "allowAnyPolicy": {
          "type": "boolean",
          "description": "Allow anyPolicy OID (2.5.29.32.0)"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ExtendedKeyUsageExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical"
        },
        "serverAuth": {
          "type": "boolean",
          "description": "TLS server authentication (id-kp-serverAuth)"
        },
        "clientAuth": {
          "type": "boolean",
          "description": "TLS client authentication (id-kp-clientAuth)"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "Extensions": {
      "properties": {
        "keyUsage": {
          "$ref": "#/$defs/KeyUsageExtension",
          "description": "Key usage extension requirements"
        },
        "basicConstraints": {
          "$ref": "#/$defs/BasicConstraintsExtension",
          "description": "Basic constraints extension requirements"
        },
        "extendedKeyUsage": {
          "$ref": "#/$defs/ExtendedKeyUsageExtension",
          "description": "Extended key usage extension requirements"
        },
        "san": {
          "$ref": "#/$defs/SANExtension",
          "description": "Subject Alternative Name extension requirements"
        },
        "authorityKeyIdentifier": {
          "$ref": "#/$defs/AuthorityKeyIDExtension",
          "description": "Authority Key Identifier extension requirements"
        },
        "subjectKeyIdentifier": {
          "$ref": "#/$defs/SubjectKeyIDExtension",
          "description": "Subject Key Identifier extension requirements"
        },
        "crlDistributionPoints": {
          "$ref": "#/$defs/CRLDistributionPointsExtension",
          "description": "CRL Distribution Points extension"
        },
        "authorityInfoAccess": {
          "$ref": "#/$defs/AuthorityInfoAccessExtension",
          "description": "Authority Information Access extension"
        },
        "certificatePolicies": {
          "$ref": "#/$defs/CertificatePoliciesExtension",
          "description": "Certificate Policies extension (RFC 5280 4.2.1.4)"
        },
        "nameConstraints": {
          "$ref": "#/$defs/NameConstraintsExtension",
          "description": "Name Constraints extension for CA certificates (RFC 5280 4.2.1.10)"
        },
        "policyConstraints": {
          "$ref": "#/$defs/PolicyConstraintsExtension",
          "description": "Policy Constraints extension for CA certificates (RFC 5280 4.2.1.11)"
        },
        "inhibitAnyPolicy": {
          "$ref": "#/$defs/InhibitAnyPolicyExtension",
          "description": "Inhibit anyPolicy extension for CA certificates (RFC 5280 4.2.1.14)"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "InhibitAnyPolicyExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical (RFC 5280 requires critical)"
        },
        "required": {
          "type": "boolean",
          "description": "Inhibit anyPolicy extension must be present"
        },
        "skipCerts": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of additional certs before anyPolicy is inhibited"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "KeyAlgorithmRule": {
      "properties": {
        "min_size": {
          "type": "integer",
          "minimum": 256,
          "description": "Minimum key size in bits"
        },
        "allowed_curves": {
          "items": {
            "type": "string",
            "enum": [
              "P-256",
              "P-384",
              "P-521",
              "brainpoolP256r1",
              "brainpoolP384r1",
              "brainpoolP512r1"
            ]
          },
          "type": "array",
          "description": "Allowed elliptic curves. Values match Go's ecdsa.PublicKey.Params().Name output."
        }
      },
      "type": "object",
      "description": "Key algorithm constraints"
    },
    "KeyUsageExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical"
        },
        "digitalSignature": {
          "type": "boolean",
          "description": "Digital signature usage"
        },
        "keyCertSign": {
          "type": "boolean",
          "description": "Certificate signing (CA only)"
        },
        "cRLSign": {
          "type": "boolean",
          "description": "CRL signing (CA only)"
        },
        "keyEncipherment": {
          "type": "boolean",
          "description": "Key encipherment usage"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "NameConstraintsExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical (RFC 5280 requires critical for CA certs)"
        },
        "required": {
          "type": "boolean",
          "description": "Name Constraints extension must be present"
        },
        "permittedDNSDomains": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Expected permitted DNS domains"
        },
        "excludedDNSDomains": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Expected excluded DNS domains"
        },
        "permittedEmailDomains": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Expected permitted email domains"
        },
        "excludedEmailDomains": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Expected excluded email domains"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "NameRule": {
      "properties": {
        "allowed": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "List of allowed name patterns (regex supported)"
        },
        "forbidden": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "List of forbidden name patterns (regex supported)"
        },
        "no_wildcards": {
          "type": "boolean",
          "description": "Disallow wildcard certificates"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "Policy": {
      "properties": {
        "name": {
          "type": "string",
          "description": "Policy name"
        },
        "cert_order": {
          "type": "integer",
          "minimum": 0,
          "description": "Position in certificate chain (0=leaf 1=intermediate 2=root)"
        },
        "description": {
          "type": "string",
          "description": "Detailed policy description"
        },
        "basic_fields": {
          "$ref": "#/$defs/BasicFieldsRule",
          "description": "RFC 5280 Section 4.1.2 TBSCertificate field requirements"
        },
        "extensions": {
          "$ref": "#/$defs/Extensions",
          "description": "RFC 5280 Section 4.2 certificate extension requirements"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name",
        "cert_order"
      ]
    },
    "PolicyConstraintsExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical"
        },
        "required": {
          "type": "boolean",
          "description": "Policy Constraints extension must be present"
        },
        "requireExplicitPolicy": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of additional certs before explicit policy required"
        },
        "inhibitPolicyMapping": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of additional certs before policy mapping inhibited"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "SANExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical"
        },
        "required": {
          "type": "boolean",
          "description": "SAN extension must be present"
        },
        "allowed": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Allowed SAN patterns (regex supported)"
        },
        "forbidden": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Forbidden SAN patterns (regex supported)"
        },
        "no_wildcards": {
          "type": "boolean",
          "description": "Disallow wildcard entries in SAN"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "SerialNumberRule": {
      "properties": {
        "require_positive": {
          "type": "boolean",
          "description": "Serial number must be a positive integer per RFC 5280"
        },
        "max_length": {
          "type": "integer",
          "maximum": 20,
          "minimum": 1,
          "description": "Maximum serial number length in octets (RFC 5280 maximum is 20)"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "SignatureAlgorithmRule": {
      "properties": {
        "allowed_algorithms": {
          "items": {
            "type": "string",
            "enum": [
              "MD5-RSA",
              "SHA1-RSA",
              "SHA256-RSA",
              "SHA384-RSA",
              "SHA512-RSA",
              "SHA256-RSAPSS",
              "SHA384-RSAPSS",
              "SHA512-RSAPSS",
              "DSA-SHA1",
              "DSA-SHA256",
              "ECDSA-SHA1",
              "ECDSA-SHA256",
              "ECDSA-SHA384",
              "ECDSA-SHA512",
              "Ed25519"
            ]
          },
          "type": "array",
          "description": "List of allowed signature algorithms. Values match Go's x509.SignatureAlgorithm.String() output."
        }
      },
      "type": "object",
      "description": "Signature algorithm constraints"
    },
    "SubjectKeyIDExtension": {
      "properties": {
        "critical": {
          "type": "boolean",
          "description": "Extension must be marked critical (RFC 5280 recommends non-critical)"
        },
        "required": {
          "type": "boolean",
          "description": "SKI extension must be present (required for CA certificates)"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "SubjectPublicKeyInfoRule": {
      "properties": {
        "allowed_algorithms": {
          "additionalProperties": {
            "$ref": "#/$defs/KeyAlgorithmRule"
          },
          "type": "object",
          "description": "Allowed public key algorithms and their constraints"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ValidityRule": {
      "properties": {
        "min_days": {
          "type": "integer",
          "minimum": 1,
          "description": "Minimum validity period in days"
        },
        "max_days": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum validity period in days"
        }
      },
      "additionalProperties": false,
      "type": "object"
    }
  },
  "title": "PCL Policy Schema",
  "description": "Schema for PCL certificate validation policies"
}